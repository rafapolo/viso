<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viso / Despesas</title>
    <link href="https://fonts.googleapis.com/css2?family=Monda:wght@400;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="https://extrapolo.com/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="module" src="src/core.js"></script>
    <script type="module" src="src/network-app.js"></script>
    <style>
        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #374151;
            border-radius: 50%;
            border-top-color: #FFC000;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Range Slider Styles */
        .slider-track {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }

        .slider-track::-webkit-slider-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #d1d5db;
            border-radius: 4px;
        }

        .dark .slider-track::-webkit-slider-track {
            background: #374151;
        }

        .slider-track::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #FFC000;
            cursor: pointer;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .dark .slider-track::-webkit-slider-thumb {
            border-color: #1f2937;
        }

        .slider-track::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #d1d5db;
            border-radius: 4px;
            border: none;
        }

        .dark .slider-track::-moz-range-track {
            background: #374151;
        }

        .slider-track::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #FFC000;
            cursor: pointer;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .dark .slider-track::-moz-range-thumb {
            border-color: #1f2937;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #FFC000;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #FFC000;
            cursor: pointer;
            border: none;
        }
        
        /* Full screen layout */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        
        .sidebar-header {
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .legend-items {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        #node-info-content {
            display: none;
            padding-top: 12px;
            border-top: 1px solid rgba(75, 85, 99, 0.3);
            margin-top: 12px;
        }
        
        /* Enhanced scrollbar styles */
        .enhanced-scroll {
            scrollbar-width: thin;
            scrollbar-color: #6B7280 #374151;
        }
        
        .enhanced-scroll::-webkit-scrollbar {
            width: 8px;
        }
        
        .enhanced-scroll::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 4px;
        }
        
        .enhanced-scroll::-webkit-scrollbar-thumb {
            background: #6B7280;
            border-radius: 4px;
        }
        
        .enhanced-scroll::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
        
        /* Transaction card enhancements */
        .transaction-card {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        .transaction-card:hover {
            transform: translateY(-1px);
        }
        
        /* Responsive card spacing */
        @media (max-width: 640px) {
            .transaction-card {
                padding: 0.75rem;
            }
        }
        
        /* Smooth scroll behavior */
        .smooth-scroll {
            scroll-behavior: smooth;
        }
        
        /* Force proper scrolling on node info panel */
        .node-info-scroll-container {
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 4px 0;
            max-height: calc(100vh - 200px);
        }
        
        /* Ensure right panel has proper height calculations */
        #right-panel {
            max-height: 100vh;
        }
        
        #node-info-section {
            max-height: calc(100vh - 60px); /* Account for header */
        }
    </style>
</head>
<body class="font-sans bg-white dark:bg-gray-950 text-gray-900 dark:text-white h-screen overflow-hidden">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-80 bg-gray-100 dark:bg-gray-900 border-r border-gray-300 dark:border-gray-700 flex flex-col">
            <div class="p-4 border-b border-gray-300 dark:border-gray-700 flex items-center gap-3">
                <div class="w-6 h-6 bg-duckdb-500 rounded flex items-center justify-center font-bold text-black text-sm">
                    üìä
                </div>
                <div class="text-base font-semibold">Viso UI</div>
                <button onclick="window.location.href='db.html'" class="ml-auto px-3 py-1.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg text-xs font-medium transition-all duration-200 transform hover:scale-105 flex items-center gap-2">
                    <span>üóÑÔ∏è</span>
                    <span>Viso DB</span>
                </button>
                <button id="theme-toggle" class="p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800">
                    üåô
                </button>
            </div>
            
            <div class="p-4 border-b border-gray-300 dark:border-gray-700">
                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Legenda</div>
                <div class="legend-items">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-deputy"></div>
                        <span class="text-gray-600 dark:text-gray-300 text-xs">Deputados</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-supplier"></div>
                        <span class="text-gray-600 dark:text-gray-300 text-xs">Empresas</span>
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-b border-gray-300 dark:border-gray-700">
                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Busca</div>
                <div class="relative">
                    <input 
                        type="text" 
                        id="searchBox" 
                        placeholder="Buscar deputado ou empresa..." 
                        class="w-full px-3 py-2 text-xs bg-white dark:bg-gray-800 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:border-duckdb-500 focus:ring-1 focus:ring-duckdb-500"
                    >
                    <button id="clearSearch" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-700 dark:hover:text-white text-sm hidden">
                        ‚úï
                    </button>
                </div>
            </div>
            
            <div class="p-4 border-b border-gray-300 dark:border-gray-700">
                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Filtros</div>
                <div class="space-y-3">
                    <div>
                        <label for="partyFilter" class="text-xs text-gray-600 dark:text-gray-300 mb-1 block">Partido:</label>
                        <select id="partyFilter" class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                            <option value="">Todos os Partidos</option>
                        </select>
                    </div>
                    <div>
                        <label for="categoryFilter" class="text-xs text-gray-600 dark:text-gray-300 mb-1 block">Categoria:</label>
                        <select id="categoryFilter" class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                            <option value="">Todas as Categorias</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Network Analysis Controls -->
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">An√°lise de Rede</div>
                <div class="space-y-2">
                    <div class="flex items-center justify-between py-1">
                        <label for="showCompanyNames" class="text-xs text-gray-600 dark:text-gray-300 flex items-center gap-2">
                            <span>üè¢</span>
                            <span>Exibir nome das Empresas</span>
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="showCompanyNames" class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <label for="showEdgeAmounts" class="text-xs text-gray-600 dark:text-gray-300 flex items-center gap-2">
                            <span>üí≥</span>
                            <span>Mostrar gasto</span>
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="showEdgeAmounts" class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>                        
                    <div class="flex items-center justify-between py-1">
                        <label for="networkDensityToggle" class="text-xs text-gray-600 dark:text-gray-300 flex items-center gap-2">
                            <span>üîó</span>
                            <span>Rede mais Densa</span>
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="networkDensityToggle" class="sr-only peer" data-active="false">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <label for="topExpensesToggle" class="text-xs text-gray-600 dark:text-gray-300 flex items-center gap-2">
                            <span>üí∞</span>
                            <span>Top 15 Gastos</span>
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="topExpensesToggle" class="sr-only peer" data-active="false">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <div>
                        <div class="flex items-center gap-2" style="padding-bottom: 10px">
                            <span class="text-duckdb-500 font-bold text-xs min-w-12" id="minValueValue">0</span>
                            <input type="range" id="minValue" class="slider-track flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer" min="0" max="100000" value="0" step="500">
                        </div>
                        <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1">
                            <span id="minRange">Min: R$ 0</span>
                            <span id="maxRange">Max: R$ 0</span>
                        </div>
                    </div>                    
                </div>
            </div>

            <div class="p-4 border-b border-gray-300 dark:border-gray-700">
                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Estat√≠sticas</div>
                <div class="stats-grid text-sm" id="stats">
                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-3 border-l-2 border-supplier">
                        <div class="text-sm font-semibold text-supplier" id="totalDeputados">-</div>
                        <div class="text-gray-500 dark:text-gray-400 text-2xs">Deputados</div>
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-3 border-l-2 border-supplier">
                        <div class="text-sm font-semibold text-supplier" id="totalFornecedores">-</div>
                        <div class="text-gray-500 dark:text-gray-400 text-2xs">Empresas</div>
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-3 border-l-2 border-supplier">
                        <div class="text-sm font-semibold text-supplier" id="totalValue">-</div>
                        <div class="text-gray-500 dark:text-gray-400 text-2xs">Total (R$)</div>
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-800 rounded p-3 border-l-2 border-supplier">
                        <div class="text-sm font-semibold text-supplier" id="totalTransactions">-</div>
                        <div class="text-gray-500 dark:text-gray-400 text-2xs">Transa√ß√µes</div>
                    </div>
                </div>
            </div>        
            
            <div class="p-4 flex-1 overflow-y-auto space-y-4">

                <!-- Category Pie Chart -->
                <div class="flex-1 flex flex-col min-h-0">
                    <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Categorias</div>
                    <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-3 flex-1 flex flex-col min-h-0">
                        <div class="flex-shrink-0 flex justify-center items-center">
                            <canvas id="categoryPieChart" width="200" height="200" style="max-width: 100%; height: auto;"></canvas>
                        </div>
                        <div id="categoryLegend" class="mt-3 space-y-1 flex-1 overflow-y-auto text-xs enhanced-scroll"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col relative">
            <!-- Visualization -->
            <div id="visualization" class="flex-1 relative overflow-hidden" style="background-color: #0f1419;">
                <svg id="network-svg" class="w-full h-full cursor-grab"></svg>
                <div id="loading" class="absolute inset-0 flex flex-col justify-center items-center text-duckdb-500 text-lg">
                    <div class="loading-spinner mb-3"></div>
                    <div>Inicializando Viso UI...</div>
                    <div id="loadingProgress" class="text-sm text-gray-400 mt-2"></div>
                </div>
                
                <!-- Zoom controls -->
                <div class="absolute top-4 right-4 flex flex-col gap-2">
                    <button id="zoom-in" class="bg-gray-800 hover:bg-gray-700 text-white w-8 h-8 rounded flex items-center justify-center text-lg font-bold">+</button>
                    <button id="zoom-out" class="bg-gray-800 hover:bg-gray-700 text-white w-8 h-8 rounded flex items-center justify-center text-lg font-bold">‚àí</button>
                    <button id="zoom-reset" class="bg-gray-800 hover:bg-gray-700 text-white w-8 h-8 rounded flex items-center justify-center text-xs font-bold">‚åÇ</button>
                </div>
                <!-- Instructions -->
                <div class="absolute bottom-2 left-2 text-xs text-gray-400">
                    Wheel: zoom ‚Ä¢ Drag: pan ‚Ä¢ Click nodes: info
                </div>
            </div>
            
            <!-- Right Sidebar (Entity Panel) -->
            <div id="right-panel" class="absolute top-0 right-0 w-80 h-full bg-gray-100 dark:bg-gray-900 border-l border-gray-300 dark:border-gray-700 flex flex-col transform translate-x-full transition-transform duration-300 ease-in-out z-10 shadow-lg">
            <div class="p-4 border-b border-gray-300 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <div class="text-sm font-semibold text-gray-900 dark:text-white">Painel da Entidade</div>
                    <button id="close-panel" class="text-gray-400 hover:text-gray-900 dark:hover:text-white text-lg font-bold hidden">&times;</button>
                </div>
            </div>
            
            <div class="flex-1 flex flex-col min-h-0" id="node-info-section">
                <div class="p-4 flex flex-col flex-1 min-h-0" id="node-info-content">
                    <p class="text-xs text-gray-500 dark:text-gray-400">Clique em um n√≥ para ver detalhes</p>
                </div>
            </div>
            </div>
        </div>
    </div>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'deputy': '#3b82f6',
                        'supplier': 'rgb(196, 82, 17)',
                        'duckdb': {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24', 
                            500: '#FFC000',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f'
                        }
                    },
                    fontFamily: {
                        'sans': ['Monda', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    }
                }
            }
        }
    </script>
</body>
</html>